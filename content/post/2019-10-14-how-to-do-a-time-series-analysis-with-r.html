---
title: "How to do a Time-Series Analysis with R"
author: "Yonas Khanna"
date: '2018-12-11'
output:
  pdf_document: default
  html_document: default
slug: how-to-do-a-time-series-analysis-with-r
tags: []
categories: []
---



<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>A Time-series <code>$\{X_T\}$</code> is a sequence of ordered data points in time, <code>$T$</code> is the value of data <code>$X$</code> point at time <code>$T$</code>. The sequence is indexed over equally spaced time points. Therefore, <code>$\{X_T\}$</code> is a sequence of discrete-time data. Time-series are often used to discover for pattern recognition and forecasting. In this technical report, a comprehensive tutorial is given of the analysis of time-series in R. Different types of modelling approaches and explanatory analysis’ are discussed.</p>
<div id="time-series-data" class="section level2">
<h2>Time-Series Data</h2>
<p>There exist two types time-series (TS), i.e. <code>$seasonal$</code> and <code>$non-seasonal\,series$</code>. The difference between these two types is that the seasonal time-series includes a returning regular pattern, which repeats over <code>$S$</code> time periods. The seasonality of the time-series is simply <code>$S$</code>, where <code>$S$</code> can be an hourly, daily, weekly, monthly, etc. time-series. To illustrate the difference of seasonal and non-seasonal series, two (fictious) will be simulated and plotted.</p>
<pre class="r"><code>#Load Libraries
library(ggplot2)
library(dplyr)</code></pre>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<pre class="r"><code>library(zoo)</code></pre>
<pre><code>## 
## Attaching package: &#39;zoo&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     as.Date, as.Date.numeric</code></pre>
<pre class="r"><code>library(lubridate)</code></pre>
<pre><code>## 
## Attaching package: &#39;lubridate&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:base&#39;:
## 
##     date</code></pre>
<pre class="r"><code>library(forecast)</code></pre>
<pre><code>## Registered S3 method overwritten by &#39;xts&#39;:
##   method     from
##   as.zoo.xts zoo</code></pre>
<pre><code>## Registered S3 method overwritten by &#39;quantmod&#39;:
##   method            from
##   as.zoo.data.frame zoo</code></pre>
<pre><code>## Registered S3 methods overwritten by &#39;forecast&#39;:
##   method             from    
##   fitted.fracdiff    fracdiff
##   residuals.fracdiff fracdiff</code></pre>
<pre class="r"><code>library(timetk)
library(gridExtra)</code></pre>
<pre><code>## 
## Attaching package: &#39;gridExtra&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     combine</code></pre>
<pre class="r"><code>library(anomalize)</code></pre>
</div>
<div id="time-series-simulation" class="section level2">
<h2>Time-Series Simulation</h2>
<pre class="r"><code>#Non-Seasonal Time-Series Generation (X)
set.seed(1)
index &lt;- ISOdatetime(2017,1,1, 0, 0, 0)+0:58*24*60*60
X &lt;- 1000+10*rnorm(length(index)) + 1:length(index)
X &lt;- zooreg(X,  order.by = index)


#Seasonal Time-Series Generation (Y)
set.seed(1)
index &lt;- ISOdatetime(2017,1,1, 0, 0, 0)+0:(58*24)*60*60
month &lt;- month(index)
hour &lt;- hour(index)
set.seed(1)
Y &lt;- 1000+10*rnorm(length(index))-(hour-12)^2 + sqrt(1:length(index))*3
Y &lt;- zooreg(Y, frequency=24,  order.by = index)

Plot_X &lt;- autoplot(X) + ggtitle(&quot;Non-Seasonal&quot;) + xlab(&quot;Time  (Daily Points)&quot;)
Plot_Y &lt;- autoplot(Y) + ggtitle(&quot;Seasonal&quot;) + xlab(&quot;Time  (Hourly Points)&quot;) 

grid.arrange(Plot_X, Plot_Y)</code></pre>
<p><img src="/post/2019-10-14-how-to-do-a-time-series-analysis-with-r_files/figure-html/unnamed-chunk-2-1.png" width="672" />
The Figures above show an example of seasonal and non-seasonal TS data. Hence, <code>$X$</code> displays random data points over time with no frequency and <code>$Y$</code> shows a recurring pattern within each 24 hours (<code>$S=24$</code>).</p>
</div>
<div id="time-series-decomposition" class="section level2">
<h2>Time-Series Decomposition</h2>
<p>TS may not only include the so-called returning pattern <code>$seasonality$</code>, but may also include a <code>$trend$</code>. The trend is a time-series pattern which shows that the TS moves in a certain direction over time. The TS’ above show an <code>$upward$</code> trend, i.e. a <code>$positive\, trend$</code>. The seasonal and trend patterns of a TS can be discovered using the <code>$Seasonal\, Trend \, Loess$</code> (STL) decomposition algorithm.</p>
<div id="stl-decomposition" class="section level3">
<h3>STL Decomposition</h3>
<pre class="r"><code>Decomposition_Y &lt;- stl(ts(Y, frequency = 24), s.window = &#39;periodic&#39;)
autoplot(Decomposition_Y$time.series, facets = TRUE) + ggtitle(&quot;STL Decomposition of Y&quot;) + ylab(&quot;&quot;)</code></pre>
<p><img src="/post/2019-10-14-how-to-do-a-time-series-analysis-with-r_files/figure-html/unnamed-chunk-3-1.png" width="672" />
The STL decompistion above, visualizes the seasonal and trend compononents of <code>$\{Y_T\}$</code> over the span of 58 periods of 24 hours. The <code>$remainder$</code> of the TS is component which shows no patterns at all, i.e., <code>$noise$</code>.</p>
</div>
<div id="time-series-anomaly-detection" class="section level3">
<h3>Time-Series Anomaly Detection</h3>
<p>Based on the section above, it follows that a TS can be summarized as the following equation:
<span class="math display">\[X_T = S_T+T_T + E_T\]</span>, where</p>
<p><code>$S_T$</code>: is the seasonal <code>$S$</code> component at time <code>$T$</code>, \
<code>$T_T$</code>: is the trend <code>$T$</code> component at time <code>$T$</code>, and \
<code>$E_T = X_T - S_T - T_T$</code>: is the noise <code>$E$</code> component at time <code>$T$</code>.</p>
<p>It may occur that TS include outliers. Outliers or anomalies in TS can be detected using</p>
</div>
</div>
</div>
